---
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { SITE_TITLE, SITE_DESCRIPTION } from '../consts';

const BUTTON_TEXT = 'Buy Astrolabe Elements Pendant - $35';
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
	</head>
	<body>
		<Header />
		<main>
			<div class="w-full">
				<img src="/magitech-transparent.png" alt="Magitech Logo" style="width: 300px; display: block; margin: 0 auto;" class="h-auto" />
			</div>
			<div style="display: flex; justify-content: center; gap: 1rem; margin-top: 2rem; max-width: 2000px; margin-left: auto; margin-right: auto; flex-wrap: wrap;">
				<img src="/astrolabe-elements-package.png" alt="Astrolabe Elements Package" style="max-height: 450px; width: auto; object-fit: contain;" />
				<img src="/astrolabe-elements-documentation.png" alt="Astrolabe Elements Documentation" style="max-height: 450px; width: auto; object-fit: contain;" />
			</div>
			<div style="text-align: center; margin-top: 2rem;">
				<a 
					id="add-to-cart-btn"
					href="#"
					style="display: inline-block; background-color: #635BFF; color: white; padding: 1rem 2rem; border-radius: 0.5rem; text-decoration: none; font-weight: bold; transition: background-color 0.2s; font-family: 'Atkinson', sans-serif; font-size: 20px;"
				>
					Buy Astrolabe Elements Pendant - $35
				</a>
			</div>
			
			<div style="max-width: 600px; margin: 4rem auto; padding: 0 1rem; text-align: center;">
				<h2 style="margin-bottom: 1rem;">stay updated on new art</h2>
				<form
					action="https://buttondown.com/api/emails/embed-subscribe/astrolabist"
					method="post"
					target="popupwindow"
					onsubmit="window.open('https://buttondown.com/astrolabist', 'popupwindow')"
					class="embeddable-buttondown-form"
					style="display: flex; flex-direction: column; gap: 1rem; align-items: center;"
				>
					<label for="bd-email" style="font-weight: bold;">Enter your email</label>
					<input 
						type="email" 
						name="email" 
						id="bd-email" 
						style="padding: 0.5rem; border: 1px solid #ccc; border-radius: 0.25rem; width: 100%; max-width: 300px;"
						required
					/>
					
					<input 
						type="submit" 
						value="Subscribe" 
						style="background-color: #635BFF; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 0.25rem; cursor: pointer; font-weight: bold;"
					/>
					<p style="font-size: 0.875rem; color: #666;">
						<a href="https://buttondown.com/refer/astrolabist" target="_blank" style="color: #635BFF;">Powered by Buttondown.</a>
					</p>
				</form>
			</div>
			
			<div style="max-width: 800px; margin: 4rem auto; padding: 0 1rem; text-align: center;">
				<h2 style="margin-bottom: 1.5rem;">my lightning talk about the astrolabe</h2>
				<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%;">
					<iframe 
						src="https://www.youtube.com/embed/h0MUKPhJaUQ" 
						style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0;"
						title="Astrolabe Lightning Talk"
						allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
						allowfullscreen
					></iframe>
				</div>
			</div>
		</main>
		<Footer />
		<!-- Cart Modal -->
		<div id="cart-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); align-items:center; justify-content:center;">
			<div style="background:white; padding:2rem; border-radius:8px; width:90%; max-width:400px;">
				<h2>Your Cart</h2>
				<ul id="cart-items" style="list-style:none; padding:0; margin:1rem 0;"></ul>
				<div style="display:flex; justify-content:space-between; margin-top:1rem;">
					<button id="keep-shopping-btn" style="padding:0.5rem 1rem; border:none; background:#ccc; border-radius:4px; cursor:pointer;">Keep Shopping</button>
					<button id="pay-btn" style="padding:0.5rem 1rem; border:none; background:#635BFF; color:white; border-radius:4px; cursor:pointer;">Pay</button>
				</div>
			</div>
		</div>

		<!-- Floating Cart Button -->
		<button id="open-cart-btn" style="display:none; position:fixed; bottom:1rem; right:1rem; width:60px; height:60px; border-radius:50%; background-color:var(--accent); color:white; font-weight:bold; font-size:16px; align-items:center; justify-content:center; cursor:pointer; font-family:'Atkinson', sans-serif; box-shadow:0 2px 6px rgba(var(--gray),25%), 0 8px 24px rgba(var(--gray),33%); display:flex;">
			<span>BUY</span><span id="cart-count" style="position:absolute; top:-4px; right:-4px; background:#4CAF50; border-radius:50%; width:20px; height:20px; display:flex; align-items:center; justify-content:center; font-size:12px;">0</span>
		</button>

		<script type="module">
			import { Cart } from '/cart.js';
			const BUTTON_TEXT = 'Buy Astrolabe Elements Pendant - $35';

			function updateCartUI() {
				const count = Cart.getItems().reduce((sum, item) => sum + item.quantity, 0);
				const openBtn = document.getElementById('open-cart-btn');
				const cartCount = document.getElementById('cart-count');
				if (openBtn && cartCount) {
					if (count > 0) {
						openBtn.style.display = 'flex';
						cartCount.textContent = count;
					} else {
						openBtn.style.display = 'none';
					}
				}
			}

			function showModal() {
				const modal = document.getElementById('cart-modal');
				if (modal) {
					modal.style.display = 'flex';
				}
			}

			function hideModal() {
				const modal = document.getElementById('cart-modal');
				if (modal) {
					modal.style.display = 'none';
				}
			}

			function renderCartItems() {
				const items = Cart.getItems();
				const itemsList = document.getElementById('cart-items');
				if (itemsList) {
					itemsList.innerHTML = '';
					items.forEach(item => {
						const li = document.createElement('li');
						li.textContent = `${item.priceId} x ${item.quantity}`;
						itemsList.appendChild(li);
					});
				}
			}

			function openCart(event) {
				event.preventDefault();
				renderCartItems();
				showModal();
			}

			function handleAddToCart(event) {
				event.preventDefault();
				Cart.addItem('prod_SDOil8nBU1UUGg');
				renderCartItems();
				updateCartUI();
				showModal();
			}

			document.addEventListener('DOMContentLoaded', () => {
				// Hide modal on initial load
				hideModal();
				updateCartUI();
				const addBtn = document.getElementById('add-to-cart-btn');
				addBtn?.addEventListener('click', handleAddToCart);

				const openBtn = document.getElementById('open-cart-btn');
				openBtn?.addEventListener('click', openCart);

				const keepBtn = document.getElementById('keep-shopping-btn');
				keepBtn?.addEventListener('click', (e) => {
					e.preventDefault();
					hideModal();
				});

				const payBtn = document.getElementById('pay-btn');
				payBtn?.addEventListener('click', (e) => {
					e.preventDefault();
					alert('Payment flow not implemented yet.');
				});

				window.addEventListener('storage', () => {
					updateCartUI();
					renderCartItems();
				});
			});
		</script>
	</body>
</html>
